<app-welcome></app-welcome>

<app-header
  [isStreaming]="isStreaming"
  [themeChoice]="themeChoice"
  (themeChange)="setTheme($event)"
  (helpClick)="toggleHelp()"
>
</app-header>

<main class="container">
  <!-- Current Status -->
  <section class="current-status-section" aria-labelledby="currentStatusTitle">
    <div class="current-status-header">
      <div class="current-status-header__main">
        <h2 class="section-title section-title--large" id="currentStatusTitle">Real-time Metrics</h2>
        <p class="section-description">
          Real-time monitoring of temperature and energy production metrics. Values update every 5 seconds with trend indicators showing recent changes.
        </p>
        <div class="current-status-meta">
          <div class="update-indicator">
            <div class="update-indicator__pulse" [class.active]="isStreaming"></div>
            <span class="update-indicator__text">
              <span class="update-indicator__time" [attr.data-time]="lastUpdatedRel">{{ lastUpdatedRel }}</span>
              <span class="update-indicator__interval">· Every 5s</span>
            </span>
          </div>
        </div>
      </div>
    </div>

    @if (processedDisplay==='0') {
    <div class="indicators-skeletons">
      <div class="indicator-skeleton"></div>
      <div class="indicator-skeleton"></div>
    </div>
    } @else {
    <div class="indicators-grid">
      <div
        class="indicator-card indicator-card--temperature"
        [attr.data-theme]="'temperature'"
        role="region"
        [attr.aria-label]="'Temperature indicator: ' + (tempKpiData.value || '0.00') + ' degrees Celsius'"
        tabindex="0"
      >
        <div class="indicator-card__header">
          <div class="indicator-card__icon-wrapper">
            <lucide-icon
              [name]="Thermometer"
              [size]="24"
              [strokeWidth]="1.5"
              aria-hidden="true"
              class="indicator-card__icon"
            ></lucide-icon>
          </div>
          <div class="indicator-card__meta">
            <h3 class="indicator-card__title">Temperature</h3>
            <span class="indicator-card__subtitle">Avg · {{ activeRangeLabel }}</span>
          </div>
        </div>

        <div class="indicator-card__value-section">
          <div class="indicator-card__main-value">
            <span class="indicator-value">{{
              tempKpiData.value || "0.00"
            }}</span>
            <span class="indicator-unit">°C</span>
          </div>
          <div
            class="indicator-card__trend"
            [class.up]="tempKpiData && tempKpiData.trend === 'up'"
            [class.down]="tempKpiData && tempKpiData.trend === 'down'"
            [class.flat]="tempKpiData && tempKpiData.trend === 'flat'"
            [style.animation]="tempKpiData && tempKpiData.trend !== 'flat' ? 'pulse 2s ease-in-out infinite' : 'none'"
          >
            <lucide-icon
              [name]="
                tempKpiData && tempKpiData.trend === 'up'
                  ? ArrowUpRight
                  : tempKpiData && tempKpiData.trend === 'down'
                  ? ArrowDownRight
                  : Minus
              "
              [size]="16"
              [strokeWidth]="2"
              aria-hidden="true"
            ></lucide-icon>
            <span style="font-weight: var(--fw-semibold);">{{ getTempTrendLabel() }}</span>
            @if (additionalMetrics.tempChangeRate !== 0) {
              <span class="muted filter-chip-rate">
                ({{ additionalMetrics.tempChangeRate > 0 ? '+' : '' }}{{ additionalMetrics.tempChangeRate.toFixed(2) }}°C/min)
              </span>
            }
          </div>
        </div>

        <div class="indicator-card__chart-wrapper">
          <canvas
            #tempSparkline
            class="indicator-sparkline"
            aria-hidden="true"
          ></canvas>
        </div>

        <div class="indicator-card__footer">
          <div class="indicator-metric">
            <span class="indicator-metric__label">Range</span>
            <span class="indicator-metric__value">
              {{
                tempKpiData?.overlaySummary
                  ? (tempKpiData.overlaySummary.min | number : "1.1-1")
                  : "0.0"
              }}
              –
              {{
                tempKpiData?.overlaySummary
                  ? (tempKpiData.overlaySummary.max | number : "1.1-1")
                  : "0.0"
              }}°C
            </span>
          </div>
        </div>
      </div>

      <div
        class="indicator-card indicator-card--energy"
        [attr.data-theme]="'energy'"
        role="region"
        [attr.aria-label]="'Energy production indicator: ' + (energyKpiData.value || '0.00') + ' kilowatt hours'"
        tabindex="0"
      >
        <div class="indicator-card__header">
          <div class="indicator-card__icon-wrapper">
            <lucide-icon
              [name]="Zap"
              [size]="24"
              [strokeWidth]="1.5"
              aria-hidden="true"
              class="indicator-card__icon"
            ></lucide-icon>
          </div>
          <div class="indicator-card__meta">
            <h3 class="indicator-card__title">Energy Production</h3>
            <span class="indicator-card__subtitle">Output · {{ activeRangeLabel }}</span>
          </div>
        </div>

        <div class="indicator-card__value-section">
          <div class="indicator-card__main-value">
            <span class="indicator-value">{{
              energyKpiData.value || "0.00"
            }}</span>
            <span class="indicator-unit">kWh</span>
          </div>
          <div
            class="indicator-card__trend"
            [class.up]="energyKpiData && energyKpiData.trend === 'up'"
            [class.down]="energyKpiData && energyKpiData.trend === 'down'"
            [class.flat]="energyKpiData && energyKpiData.trend === 'flat'"
            [style.animation]="energyKpiData && energyKpiData.trend !== 'flat' ? 'pulse 2s ease-in-out infinite' : 'none'"
          >
            <lucide-icon
              [name]="
                energyKpiData && energyKpiData.trend === 'up'
                  ? ArrowUpRight
                  : energyKpiData && energyKpiData.trend === 'down'
                  ? ArrowDownRight
                  : Minus
              "
              [size]="16"
              [strokeWidth]="2"
              aria-hidden="true"
            ></lucide-icon>
            <span style="font-weight: var(--fw-semibold);">{{ getEnergyTrendLabel() }}</span>
            @if (additionalMetrics.energyChangeRate !== 0) {
              <span class="muted filter-chip-rate">
                ({{ additionalMetrics.energyChangeRate > 0 ? '+' : '' }}{{ additionalMetrics.energyChangeRate.toFixed(2) }}kWh/min)
              </span>
            }
          </div>
        </div>

        <div class="indicator-card__chart-wrapper">
          <canvas
            #energySparklineCanvas
            class="indicator-sparkline"
            aria-hidden="true"
          ></canvas>
        </div>

        <div class="indicator-card__footer">
          <div class="indicator-metric">
            <span class="indicator-metric__label">Range</span>
            <span class="indicator-metric__value">
              {{
                energyKpiData?.overlaySummary
                  ? (energyKpiData.overlaySummary.min | number : "1.2-2")
                  : "0.00"
              }}
              –
              {{
                energyKpiData?.overlaySummary
                  ? (energyKpiData.overlaySummary.max | number : "1.2-2")
                  : "0.00"
              }}
              kWh
            </span>
          </div>
        </div>
      </div>
    </div>
    }
  </section>

  <!-- Time Series Charts -->
  <section class="charts-section" aria-labelledby="chartsTitle">
    <div class="charts-header">
      <div class="charts-header__title-section">
        <h2 class="section-title" id="chartsTitle">Time Series Analysis</h2>
        <p class="section-description">
          Interactive line charts displaying temperature and energy production over time. Use the time range selector to view different periods. Export charts as PNG or download data as CSV.
        </p>
      </div>
      
      <div class="charts-header__toolbar">
        <div class="charts-toolbar__group charts-toolbar__group--primary">
          <div class="range-selector-group">
            <span class="range-selector-label" id="rangeLabel">Time Range</span>
            <div class="range-buttons" role="group" aria-labelledby="rangeLabel">
              @for (range of ranges; track range.key) {
              <button
                type="button"
                class="range-button"
                [class.active]="activeRangeKey === range.key"
                (click)="onChangeRange(range.key)"
                [attr.aria-pressed]="activeRangeKey === range.key"
                [attr.aria-label]="'Select ' + range.label + ' time range'"
                [attr.tabindex]="activeRangeKey === range.key ? '0' : '-1'"
              >
                {{ range.label }}
              </button>
              }
            </div>
          </div>
        </div>
        
        <div class="charts-toolbar__group charts-toolbar__group--tools">
          <span class="range-selector-label" id="toolsLabel">Tools</span>
          <div class="tools-cards" role="group" aria-labelledby="toolsLabel">
            <button
              class="tool-card"
              (click)="toggleComparison()"
              [class.active]="showComparison"
              type="button"
              aria-label="Toggle comparison mode"
              title="Compare periods"
            >
              <lucide-icon [name]="BarChart" [size]="18" aria-hidden="true"></lucide-icon>
              <span class="tool-card__label">Compare</span>
            </button>
            <button
              class="tool-card"
              (click)="toggleAlerts()"
              [class.active]="showAlerts"
              type="button"
              aria-label="Toggle alerts"
              title="Configure alerts"
            >
              <lucide-icon [name]="Bell" [size]="18" aria-hidden="true"></lucide-icon>
              <span class="tool-card__label">Alerts</span>
            </button>
            <button
              class="tool-card"
              (click)="toggleFilters()"
              [class.active]="showFilters"
              type="button"
              aria-label="Toggle filters"
              title="Filter data"
            >
              <lucide-icon [name]="Filter" [size]="18" aria-hidden="true"></lucide-icon>
              <span class="tool-card__label">Filters</span>
            </button>
            <button
              class="tool-card"
              (click)="toggleSavedViews()"
              [class.active]="showSavedViews"
              type="button"
              aria-label="Saved views"
              title="Saved views"
            >
              <lucide-icon [name]="Bookmark" [size]="18" aria-hidden="true"></lucide-icon>
              <span class="tool-card__label">Views</span>
            </button>
      </div>
        </div>
      </div>

      <!-- Comparison Modal -->
      @if (showComparison) {
      <div class="help-modal-overlay" data-modal-type="tools" (click)="toggleComparison()" role="dialog" aria-modal="true" aria-labelledby="comparison-title">
        <div class="help-modal" (click)="$event.stopPropagation()">
          <div class="help-modal__header">
            <div class="help-modal__header-content">
              <h2 id="comparison-title" class="help-modal__title">Period Comparison</h2>
              <p class="help-modal__subtitle">Compare current period with previous period</p>
            </div>
            <button
              class="help-modal__close"
              (click)="toggleComparison()"
              aria-label="Close comparison"
              type="button"
            >
              <lucide-icon [name]="X" [size]="18" aria-hidden="true"></lucide-icon>
            </button>
          </div>
          <div class="help-modal__content">
            <div class="comparison-content">
              <div class="comparison-explanation">
                <p class="muted">
                  <lucide-icon [name]="Info" [size]="14" aria-hidden="true"></lucide-icon>
                  Enable comparison mode to see the previous period overlaid on the charts as a dashed line.
                </p>
              </div>
              <div class="form-group" style="margin-top: var(--space-5);">
                <label style="display: flex; align-items: center; gap: var(--space-3); cursor: pointer;">
                  <input 
                    type="checkbox" 
                    [checked]="comparisonMode"
                    (change)="toggleComparisonMode()"
                  />
                  <span style="font-weight: var(--fw-medium);">Enable Comparison Mode</span>
                </label>
              </div>
              @if (comparisonMode) {
              <div class="comparison-stats" style="margin-top: var(--space-5);">
                <div class="comparison-stat">
                  <div class="comparison-stat-header">
                    <span class="comparison-label">Temperature</span>
                    <span class="comparison-value" [class.positive]="deltas.tempAvgPct > 0" [class.negative]="deltas.tempAvgPct < 0">
                      {{ deltas.tempAvgPct > 0 ? '+' : '' }}{{ deltas.tempAvgPct.toFixed(1) }}%
                    </span>
                  </div>
                  <div class="comparison-details">
                    <span class="comparison-detail">
                      Current: <strong>{{ comparisonValues.currentTempAvg.toFixed(1) }}°C</strong>
                    </span>
                    <span class="comparison-detail">
                      Previous: <strong>{{ comparisonValues.previousTempAvg.toFixed(1) }}°C</strong>
                    </span>
                  </div>
                </div>
                <div class="comparison-stat">
                  <div class="comparison-stat-header">
                    <span class="comparison-label">Energy</span>
                    <span class="comparison-value" [class.positive]="deltas.energySumPct > 0" [class.negative]="deltas.energySumPct < 0">
                      {{ deltas.energySumPct > 0 ? '+' : '' }}{{ deltas.energySumPct.toFixed(1) }}%
                    </span>
                  </div>
                  <div class="comparison-details">
                    <span class="comparison-detail">
                      Current: <strong>{{ comparisonValues.currentEnergySum.toFixed(2) }} kWh</strong>
                    </span>
                    <span class="comparison-detail">
                      Previous: <strong>{{ comparisonValues.previousEnergySum.toFixed(2) }} kWh</strong>
                    </span>
                  </div>
                </div>
                <div class="muted" style="margin-top: var(--space-4); font-size: var(--fs-xs);">
                  Comparing <strong>current {{ activeRangeLabel }}</strong> with <strong>previous {{ activeRangeLabel }}</strong>
                </div>
              </div>
              }
            </div>
          </div>
        </div>
      </div>
      }

      <!-- Alerts Modal -->
      @if (showAlerts) {
      <div class="help-modal-overlay" data-modal-type="tools" (click)="toggleAlerts()" role="dialog" aria-modal="true" aria-labelledby="alerts-title">
        <div class="help-modal" (click)="$event.stopPropagation()">
          <div class="help-modal__header">
            <div class="help-modal__header-content">
              <h2 id="alerts-title" class="help-modal__title">Configure Alerts</h2>
              <p class="help-modal__subtitle">Set up notifications for temperature and energy thresholds</p>
            </div>
            <button
              class="help-modal__close"
              (click)="toggleAlerts()"
              aria-label="Close alerts"
              type="button"
            >
              <lucide-icon [name]="X" [size]="18" aria-hidden="true"></lucide-icon>
            </button>
          </div>
          <div class="help-modal__content">
            <div class="alerts-content">
          <div class="alerts-explanation">
            <p class="muted">
              <lucide-icon [name]="Info" [size]="14" aria-hidden="true"></lucide-icon>
              Alerts notify you when values exceed your thresholds. You'll see a notification when triggered.
            </p>
          </div>
          <div class="alert-settings">
            <div class="form-group">
              <label>
                <input 
                  type="checkbox" 
                  [checked]="alertSettings.enableBrowserNotifications"
                  (change)="alertSettings.enableBrowserNotifications = ($any($event.target).checked); requestNotificationPermission()"
                />
                Enable browser notifications
              </label>
              @if (notificationPermission === 'default') {
                <button 
                  class="action-button action-button--secondary"
                  (click)="requestNotificationPermission()"
                  type="button"
                  style="margin-top: 8px;"
                >
                  Request Permission
                </button>
              }
              @if (notificationPermission === 'granted') {
                <span class="muted" style="margin-left: 8px; color: var(--success);">✓ Enabled</span>
              }
              @if (notificationPermission === 'denied') {
                <span class="muted" style="margin-left: 8px; color: var(--error);">✗ Denied</span>
              }
            </div>
            <div class="form-group">
              <label>Cooldown (seconds)</label>
              <input 
                type="number" 
                class="form-input" 
                [value]="alertSettings.cooldownSeconds"
                (input)="updateCooldown($any($event.target).value)"
                min="10"
                max="3600"
                step="10"
              />
              <span class="muted filter-help-text">
                Prevent alert spam by waiting {{ alertSettings.cooldownSeconds }}s between triggers
              </span>
            </div>
          </div>
          <div class="alert-form">
            <div class="form-group">
              <label>Metric</label>
              <select #alertType class="form-input">
                <option value="temperature">Temperature</option>
                <option value="energy">Energy</option>
              </select>
            </div>
            <div class="form-group">
              <label>Condition</label>
              <select #alertCondition class="form-input">
                <option value="above">Above</option>
                <option value="below">Below</option>
              </select>
            </div>
            <div class="form-group">
              <label>Threshold</label>
              <input type="number" #alertThreshold class="form-input" placeholder="Value" step="0.1" />
            </div>
            <button
              class="export-button"
              (click)="addAlertFromInputs(alertType.value, alertThreshold.value, alertCondition.value)"
              type="button"
            >
              Add Alert
            </button>
          </div>
          @if (alerts.length > 0) {
            <div class="alerts-list">
              <div class="alerts-list-header">
                <span class="alerts-count">{{ alerts.length }} alert{{ alerts.length !== 1 ? 's' : '' }}</span>
              </div>
              @for (alert of alerts; track alert.id) {
              <div class="alert-item" [class.triggered]="alert.triggered">
                <div class="alert-info">
                  <div class="alert-metric">
                    <lucide-icon 
                      [name]="alert.type === 'temperature' ? Thermometer : Zap" 
                      [size]="14" 
                      aria-hidden="true"
                    ></lucide-icon>
                    <strong>{{ alert.type === 'temperature' ? 'Temperature' : 'Energy' }}</strong>
                  </div>
                  <span class="alert-condition">
                    {{ alert.condition === 'above' ? '>' : '<' }} 
                    <strong>{{ alert.threshold }}{{ alert.type === 'temperature' ? '°C' : 'kWh' }}</strong>
                  </span>
                  @if (alert.triggered) {
                    <span class="alert-status">Active</span>
                  }
                  @if (alert.triggerCount > 0) {
                    <span class="muted filter-chip-rate">
                      Triggered {{ alert.triggerCount }} time{{ alert.triggerCount !== 1 ? 's' : '' }}
                    </span>
                  }
                </div>
                <button class="alert-remove" (click)="removeAlert(alert.id)" type="button" aria-label="Remove alert">
                  <lucide-icon [name]="X" [size]="16" aria-hidden="true"></lucide-icon>
                </button>
              </div>
              }
            </div>
          } @else {
            <div class="alerts-empty">
              <p class="muted">No alerts configured. Add one above to get notified when values exceed thresholds.</p>
            </div>
          }
          @if (alertHistory.length > 0) {
            <div class="alert-history-section">
              <div class="alerts-list-header" style="margin-top: var(--space-4);">
                <span class="alerts-count">Alert History ({{ alertHistory.length }})</span>
                <button 
                  class="action-button action-button--secondary"
                  (click)="clearAlertHistory()"
                  type="button"
                  class="filter-chip-rate"
                >
                  Clear
                </button>
              </div>
              <div class="alert-history-list" style="max-height: 300px; overflow-y: auto;">
                @for (historyItem of alertHistory.slice(0, 20); track historyItem.id) {
                  <div class="alert-history-item">
                    <div class="alert-history-info">
                      <div style="display: flex; align-items: center; gap: 8px;">
                        <lucide-icon 
                          [name]="historyItem.type === 'temperature' ? Thermometer : Zap" 
                          [size]="12" 
                          aria-hidden="true"
                        ></lucide-icon>
                        <strong>{{ historyItem.type === 'temperature' ? 'Temperature' : 'Energy' }}</strong>
                        <span class="muted filter-chip-rate">
                          {{ historyItem.condition === 'above' ? '>' : '<' }} {{ historyItem.threshold }}{{ historyItem.type === 'temperature' ? '°C' : 'kWh' }}
                        </span>
                      </div>
                      <span class="muted filter-chip-rate">
                        Value: {{ historyItem.value.toFixed(2) }}{{ historyItem.type === 'temperature' ? '°C' : 'kWh' }}
                      </span>
                    </div>
                    <span class="muted filter-chip-rate">
                      {{ formatTimestamp(historyItem.timestamp) }}
                    </span>
                  </div>
                }
              </div>
            </div>
          }
            </div>
          </div>
        </div>
      </div>
      }

      <!-- Filters Modal -->
      @if (showFilters) {
      <div class="help-modal-overlay" data-modal-type="filters" (click)="toggleFilters()" role="dialog" aria-modal="true" aria-labelledby="filters-title">
        <div class="help-modal" (click)="$event.stopPropagation()">
          <div class="help-modal__header">
            <div class="help-modal__header-content">
              <h2 id="filters-title" class="help-modal__title">Filter Data</h2>
              <p class="help-modal__subtitle">Filter data by temperature, energy, time, and trends</p>
            </div>
            <button
              class="help-modal__close"
              (click)="toggleFilters()"
              aria-label="Close filters"
              type="button"
            >
              <lucide-icon [name]="X" [size]="18" aria-hidden="true"></lucide-icon>
            </button>
          </div>
          <div class="help-modal__content">
            <div class="filters-content">
          <div class="filter-group">
            <label>Temperature Range</label>
            <div class="filter-inputs">
              <input type="number" [(ngModel)]="valueFilters.tempMin" class="form-input" placeholder="Min" />
              <span>to</span>
              <input type="number" [(ngModel)]="valueFilters.tempMax" class="form-input" placeholder="Max" />
            </div>
          </div>
          <div class="filter-group">
            <label>Energy Range</label>
            <div class="filter-inputs">
              <input type="number" [(ngModel)]="valueFilters.energyMin" class="form-input" placeholder="Min" />
              <span>to</span>
              <input type="number" [(ngModel)]="valueFilters.energyMax" class="form-input" placeholder="Max" />
            </div>
          </div>
          <div class="filter-group" style="margin-top: var(--space-4); padding-top: var(--space-4); border-top: var(--border-width) solid var(--border);">
            <label style="font-weight: var(--fw-semibold); margin-bottom: var(--space-2);">Advanced Filters</label>
            <div class="form-group" style="margin-top: var(--space-3);">
              <label>Time Range (Hours)</label>
              <div class="filter-inputs">
                <input 
                  type="number" 
                  [(ngModel)]="advancedFilters.hourStart" 
                  class="form-input" 
                  placeholder="Start"
                  min="0"
                  max="23"
                />
                <span>to</span>
                <input 
                  type="number" 
                  [(ngModel)]="advancedFilters.hourEnd" 
                  class="form-input" 
                  placeholder="End"
                  min="0"
                  max="23"
                />
              </div>
              <span class="muted filter-help-text">
                Filter data by time of day (0-23)
              </span>
            </div>
            <div class="form-group" style="margin-top: var(--space-3);">
              <label>Days of Week</label>
              <div style="display: flex; flex-wrap: wrap; gap: var(--space-2); margin-top: var(--space-2);">
                @for (day of [0,1,2,3,4,5,6]; track day) {
                  <label class="filter-day-label">
                    <input 
                      type="checkbox" 
                      [checked]="advancedFilters.daysOfWeek.includes(day)"
                      (change)="toggleDayOfWeek(day, $any($event.target).checked)"
                    />
                    {{ ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'][day] }}
                  </label>
                }
              </div>
            </div>
            <div class="form-group" style="margin-top: var(--space-3);">
              <label>Trend Filter</label>
              <select [(ngModel)]="advancedFilters.trendFilter" class="form-input">
                <option value="all">All Trends</option>
                <option value="up">Rising Only</option>
                <option value="down">Falling Only</option>
                <option value="flat">Stable Only</option>
              </select>
            </div>
          </div>
          <div class="filter-actions">
            <button class="export-button" (click)="applyFilters()" type="button">Apply Filters</button>
            <button class="export-button export-button--secondary" (click)="clearFilters()" type="button">Clear</button>
          </div>
            </div>
          </div>
        </div>
      </div>
      }

      <!-- Saved Views Modal -->
      @if (showSavedViews) {
      <div class="help-modal-overlay" data-modal-type="tools" (click)="toggleSavedViews()" role="dialog" aria-modal="true" aria-labelledby="views-title">
        <div class="help-modal" (click)="$event.stopPropagation()">
          <div class="help-modal__header">
            <div class="help-modal__header-content">
              <h2 id="views-title" class="help-modal__title">Saved Views</h2>
              <p class="help-modal__subtitle">Save and load your dashboard configurations</p>
            </div>
            <button
              class="help-modal__close"
              (click)="toggleSavedViews()"
              aria-label="Close saved views"
              type="button"
            >
              <lucide-icon [name]="X" [size]="18" aria-hidden="true"></lucide-icon>
            </button>
          </div>
          <div class="help-modal__content">
            <div class="saved-views-content">
          <div class="save-view-form">
            <input #viewName type="text" class="form-input" placeholder="View name" />
            <button class="export-button" (click)="saveCurrentView(viewName.value); viewName.value = ''" type="button">
              <lucide-icon [name]="Save" [size]="16" aria-hidden="true"></lucide-icon>
              Save Current View
            </button>
          </div>
          <div class="saved-views-list">
            @for (view of savedViews; track view.id) {
            <div class="saved-view-item">
              <span>{{ view.name }}</span>
              <div class="saved-view-actions">
                <button class="action-button action-button--small" (click)="loadView(view.id)" type="button">Load</button>
                <button class="action-button action-button--small action-button--danger" (click)="deleteView(view.id)" type="button">Delete</button>
              </div>
            </div>
            }
          </div>
            </div>
          </div>
        </div>
      </div>
      }

      <div class="charts-toolbar__exports-bar" aria-label="Exports">
        <span class="range-selector-label">Export</span>
        <div class="charts-toolbar__exports">
          <button
            class="toolbar-button"
            (click)="exportChartAsImage('temperature')"
            type="button"
            title="Export Temperature Chart"
            aria-label="Export temperature chart as PNG"
          >
            <lucide-icon [name]="Image" [size]="16" aria-hidden="true"></lucide-icon>
            Temperature
          </button>
          <button
            class="toolbar-button"
            (click)="exportChartAsImage('energy')"
            type="button"
            title="Export Energy Chart"
            aria-label="Export energy chart as PNG"
          >
            <lucide-icon [name]="Image" [size]="16" aria-hidden="true"></lucide-icon>
            Energy
          </button>
          <button
            class="toolbar-button"
            (click)="exportDataAsCSV()"
            type="button"
            title="Export All Data"
            aria-label="Export all data as CSV"
          >
            <lucide-icon [name]="Download" [size]="16" aria-hidden="true"></lucide-icon>
            CSV
          </button>
          <button
            class="toolbar-button"
            (click)="exportChartsAsCombinedImage()"
            type="button"
            title="Export Combined Charts"
            aria-label="Export both charts as combined image"
          >
            <lucide-icon [name]="Image" [size]="16" aria-hidden="true"></lucide-icon>
            Combined
          </button>
          <button
            class="toolbar-button"
            (click)="exportStatisticsAsJSON()"
            type="button"
            title="Export Statistics"
            aria-label="Export statistics as JSON"
          >
            <lucide-icon [name]="FileText" [size]="16" aria-hidden="true"></lucide-icon>
            Stats JSON
          </button>
        </div>
      </div>
    </div>
    
    <div class="charts-toolbar__info">
      <div class="toolbar-info-item">
        <lucide-icon [name]="Database" [size]="14" aria-hidden="true"></lucide-icon>
        <span class="toolbar-info-label">Data Points:</span>
        <span class="toolbar-info-value">{{ dataHistory?.length || 0 }}</span>
      </div>
      <div class="toolbar-info-item">
        <lucide-icon [name]="Calendar" [size]="14" aria-hidden="true"></lucide-icon>
        <span class="toolbar-info-label">Window:</span>
        <span class="toolbar-info-value">{{ activeRangeLabel }}</span>
      </div>
      <div class="toolbar-info-item">
        <lucide-icon [name]="Activity" [size]="14" aria-hidden="true"></lucide-icon>
        <span class="toolbar-info-label">Update Rate:</span>
        <span class="toolbar-info-value">Every 5s</span>
      </div>
    </div>

    <!-- Active Filters Summary Chips -->
    @if (hasActiveFilters()) {
    <div class="filter-summary" role="region" aria-label="Active filters">
      <span class="filter-summary-label">Active Filters:</span>
      @for (chip of getActiveFilterChips(); track chip.type) {
      <span class="filter-chip">
        <strong>{{ chip.label }}:</strong> {{ chip.value }}
        <button 
          class="filter-chip__remove" 
          (click)="removeFilterChip(chip.type)" 
          type="button"
          [attr.aria-label]="'Remove ' + chip.label + ' filter'"
        >
          ×
        </button>
      </span>
      }
      <button 
        class="export-button export-button--secondary" 
        (click)="clearFilters()" 
        type="button"
        style="margin-left: auto; padding: var(--space-1) var(--space-3); font-size: var(--fs-xs);"
      >
        Clear All
      </button>
    </div>
    }

    <!-- Visible Series Toggle - Just above charts -->
    <div class="series-toggle-group">
      <span class="series-toggle-label" id="seriesLabel">Visible Series:</span>
      <div class="series-toggles" role="group" aria-labelledby="seriesLabel">
        <label class="toggle">
          <input
            #tempChk2
            type="checkbox"
            [checked]="showTemp"
            (change)="onTempCheckboxChange(tempChk2.checked)"
            aria-label="Toggle temperature series visibility"
          />
          <span>
            <lucide-icon
              [name]="Thermometer"
              [size]="14"
              [strokeWidth]="1.5"
              aria-hidden="true"
            ></lucide-icon>
            Temperature
          </span>
        </label>

        <label class="toggle">
          <input
            #energyChk2
            type="checkbox"
            [checked]="showEnergy"
            (change)="onEnergyCheckboxChange(energyChk2.checked)"
            aria-label="Toggle energy series visibility"
          />
          <span>
            <lucide-icon
              [name]="Zap"
              [size]="14"
              [strokeWidth]="1.5"
              aria-hidden="true"
            ></lucide-icon>
            Energy
          </span>
        </label>
      </div>
    </div>

    <!-- Charts -->
    <div class="charts">
      <div class="chart-container card-surface">
        <div class="chart-header">
          <div class="chart-header__main">
            <div class="chart-header__title">
              <lucide-icon [name]="Thermometer" [size]="18" aria-hidden="true"></lucide-icon>
              <span>Temperature</span>
            </div>
            <div class="chart-header__meta">
              <span class="chart-meta-item">
                <span class="chart-meta-label">Avg</span>
                <span class="chart-meta-value">{{ stats.tempAvg.toFixed(1) }}°C</span>
              </span>
              <span class="chart-meta-item">
                <span class="chart-meta-label">Max</span>
                <span class="chart-meta-value">{{ stats.tempMax.toFixed(1) }}°C</span>
              </span>
            </div>
          </div>
        <div class="chart-header__actions">
          <button
            class="chart-action"
            type="button"
            (click)="exportChartAsImage('temperature')"
            aria-label="Export temperature chart as PNG"
            title="Export temperature chart"
          >
            <lucide-icon [name]="Download" [size]="14" aria-hidden="true"></lucide-icon>
          </button>
        </div>
        </div>
        <p id="tempChartDesc" class="sr-only">
          Line chart of temperature in degrees Celsius. Active window:
          {{ activeRangeLabel }}. Last update: {{ lastUpdatedRel }}.
        </p>
        <canvas
          #temperatureChart
          role="img"
          [attr.aria-label]="
            'Temperature series in °C, window ' + activeRangeLabel
          "
          [attr.aria-describedby]="'tempChartDesc'"
        >
        </canvas>
      </div>

      <div class="chart-container card-surface">
        <div class="chart-header">
          <div class="chart-header__main">
            <div class="chart-header__title">
              <lucide-icon [name]="Zap" [size]="18" aria-hidden="true"></lucide-icon>
              <span>Energy Production</span>
            </div>
            <div class="chart-header__meta">
              <span class="chart-meta-item">
                <span class="chart-meta-label">Total</span>
                <span class="chart-meta-value">{{ stats.energySum.toFixed(2) }} kWh</span>
              </span>
              <span class="chart-meta-item">
                <span class="chart-meta-label">Avg/min</span>
                <span class="chart-meta-value">{{ stats.prodAvgPerMin.toFixed(3) }}</span>
              </span>
            </div>
          </div>
        <div class="chart-header__actions">
          <button
            class="chart-action"
            type="button"
            (click)="exportChartAsImage('energy')"
            aria-label="Export energy chart as PNG"
            title="Export energy chart"
          >
            <lucide-icon [name]="Download" [size]="14" aria-hidden="true"></lucide-icon>
          </button>
        </div>
        </div>
        <p id="energyChartDesc" class="sr-only">
          Line chart of energy produced in kilowatt-hours. Active window:
          {{ activeRangeLabel }}. Last update: {{ lastUpdatedRel }}.
        </p>
        <canvas
          #energyChart
          role="img"
          [attr.aria-label]="'Energy series in kWh, window ' + activeRangeLabel"
          [attr.aria-describedby]="'energyChartDesc'"
        >
        </canvas>
      </div>
    </div>
  </section>

  <!-- Additional Metrics Section -->
  <section class="additional-metrics-section" aria-labelledby="additionalMetricsTitle">
    <div class="additional-metrics-header">
      <h2 class="section-title" id="additionalMetricsTitle">Advanced Metrics</h2>
      <p class="section-description">
        Detailed statistical analysis including change rates, percentiles, standard deviation, and correlation between temperature and energy production.
      </p>
    </div>
    <div class="additional-metrics-grid">
      <div class="metric-card">
        <div class="metric-card__header">
          <lucide-icon [name]="TrendingUp" [size]="18" aria-hidden="true"></lucide-icon>
          <span>Change Rates</span>
        </div>
        <div class="metric-card__content">
          <div class="metric-item">
            <span class="metric-label">Temperature:</span>
            <span class="metric-value" [class.positive]="additionalMetrics.tempChangeRate > 0" [class.negative]="additionalMetrics.tempChangeRate < 0">
              {{ additionalMetrics.tempChangeRate > 0 ? '+' : '' }}{{ additionalMetrics.tempChangeRate.toFixed(2) }}°C/min
            </span>
          </div>
          <div class="metric-item">
            <span class="metric-label">Energy:</span>
            <span class="metric-value" [class.positive]="additionalMetrics.energyChangeRate > 0" [class.negative]="additionalMetrics.energyChangeRate < 0">
              {{ additionalMetrics.energyChangeRate > 0 ? '+' : '' }}{{ additionalMetrics.energyChangeRate.toFixed(2) }}kWh/min
            </span>
          </div>
        </div>
      </div>
      <div class="metric-card">
        <div class="metric-card__header">
          <lucide-icon [name]="BarChart3" [size]="18" aria-hidden="true"></lucide-icon>
          <span>Statistical Measures</span>
        </div>
        <div class="metric-card__content">
          <div class="metric-item">
            <span class="metric-label">Temp Std Dev:</span>
            <span class="metric-value">{{ additionalMetrics.tempStdDev.toFixed(2) }}°C</span>
          </div>
          <div class="metric-item">
            <span class="metric-label">Energy Std Dev:</span>
            <span class="metric-value">{{ additionalMetrics.energyStdDev.toFixed(2) }}kWh</span>
          </div>
          <div class="metric-item">
            <span class="metric-label">Temp Median:</span>
            <span class="metric-value">{{ additionalMetrics.tempMedian.toFixed(2) }}°C</span>
          </div>
          <div class="metric-item">
            <span class="metric-label">Energy Median:</span>
            <span class="metric-value">{{ additionalMetrics.energyMedian.toFixed(2) }}kWh</span>
          </div>
        </div>
      </div>
      <div class="metric-card">
        <div class="metric-card__header">
          <lucide-icon [name]="Gauge" [size]="18" aria-hidden="true"></lucide-icon>
          <span>Percentiles</span>
        </div>
        <div class="metric-card__content">
          <div class="metric-item">
            <span class="metric-label">Temp (25th-75th):</span>
            <span class="metric-value">{{ additionalMetrics.tempPercentile25.toFixed(2) }} - {{ additionalMetrics.tempPercentile75.toFixed(2) }}°C</span>
          </div>
          <div class="metric-item">
            <span class="metric-label">Energy (25th-75th):</span>
            <span class="metric-value">{{ additionalMetrics.energyPercentile25.toFixed(2) }} - {{ additionalMetrics.energyPercentile75.toFixed(2) }}kWh</span>
          </div>
        </div>
      </div>
      <div class="metric-card">
        <div class="metric-card__header">
          <lucide-icon [name]="ArrowLeftRight" [size]="18" aria-hidden="true"></lucide-icon>
          <span>Historical & Correlation</span>
        </div>
        <div class="metric-card__content">
          <div class="metric-item">
            <span class="metric-label">Historical Avg Temp:</span>
            <span class="metric-value">{{ additionalMetrics.historicalAvg.temp.toFixed(2) }}°C</span>
          </div>
          <div class="metric-item">
            <span class="metric-label">Historical Avg Energy:</span>
            <span class="metric-value">{{ additionalMetrics.historicalAvg.energy.toFixed(2) }}kWh</span>
          </div>
          <div class="metric-item">
            <span class="metric-label">Correlation:</span>
            <span class="metric-value">{{ additionalMetrics.correlation.toFixed(3) }}</span>
            <span class="muted filter-chip-rate">
              ({{ additionalMetrics.correlation > 0.7 ? 'Strong' : additionalMetrics.correlation > 0.3 ? 'Moderate' : 'Weak' }})
            </span>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Analytics (Unified Statistics + Period Summary) -->
  <section class="analytics-section card-surface" aria-labelledby="analyticsTitle">
    <div class="analytics-header">
      <h2 class="section-title" id="analyticsTitle">Analytics</h2>
      <p class="section-description">
        Comprehensive statistics and performance metrics for the selected time period. Compare current values with previous periods and track key performance indicators.
      </p>
      <div class="muted">Time window: {{ activeRangeLabel }}</div>
    </div>

    <!-- Key Metrics Grid -->
    <div class="analytics-key-metrics">
      <p class="section-description section-description--inline">
        Key performance indicators showing peak values and average measurements for the current monitoring period.
      </p>
      <div class="card kpi" role="group" aria-label="Energy peak">
        <div class="kpi-head">
          <div class="kpi-title">
            <lucide-icon
              [name]="Zap"
              [size]="20"
              [strokeWidth]="1.5"
              aria-hidden="true"
            ></lucide-icon>
            <span>Energy Peak</span>
          </div>
        </div>
        <div class="kpi-body">
          <div class="kpi-value">
            {{ energyPeakKwh.toFixed(2) }}<span class="unit">kWh</span>
          </div>
          <div class="muted">Today at {{ energyPeakTime }}</div>
        </div>
      </div>

      <div
        class="card kpi"
        role="group"
        aria-label="Average temperature"
      >
        <div class="kpi-head">
          <div class="kpi-title">
            <lucide-icon
              [name]="Thermometer"
              [size]="20"
              [strokeWidth]="1.5"
              aria-hidden="true"
            ></lucide-icon>
            <span>Average Temperature</span>
          </div>
        </div>
        <div class="kpi-body">
          <div class="kpi-value">
            {{ stats.tempAvg.toFixed(1) }}<span class="unit">°C</span>
          </div>
          <div class="muted">Last {{ activeRangeLabel }}</div>
        </div>
      </div>

      <div class="card kpi" role="group" aria-label="Thermal variation">
        <div class="kpi-head">
          <div class="kpi-title">
            <lucide-icon
              [name]="Activity"
              [size]="20"
              [strokeWidth]="1.5"
              aria-hidden="true"
            ></lucide-icon>
            <span>Thermal Variation</span>
          </div>
        </div>
        <div class="kpi-body">
          <div class="kpi-value kpi-value--with-trend">
            <span>{{ tempVariationLabel.replace(".", ",") }}</span>
            <span
              class="kpi-trend"
              [class.up]="tempDeltaDir === 'up'"
              [class.down]="tempDeltaDir === 'down'"
            >
              <lucide-icon
                class="kpi-trend__icon"
                [name]="
                  tempDeltaDir === 'up'
                    ? ArrowUpRight
                    : tempDeltaDir === 'down'
                    ? ArrowDownRight
                    : Minus
                "
                [size]="14"
                [strokeWidth]="1.5"
                aria-hidden="true"
              >
              </lucide-icon>
            </span>
          </div>
          <div class="muted">{{ tempStateLabel }}</div>
        </div>
      </div>

      <div
        class="card kpi"
        role="group"
        aria-label="Accumulated energy"
      >
        <div class="kpi-head">
          <div class="kpi-title">
            <lucide-icon
              [name]="BatteryCharging"
              [size]="20"
              [strokeWidth]="1.5"
              aria-hidden="true"
            ></lucide-icon>
            <span>Accumulated Energy</span>
          </div>
        </div>
        <div class="kpi-body">
          <div class="kpi-value">
            {{ stats.energySum.toFixed(2) }}<span class="unit">kWh</span>
          </div>
          <div class="muted">Last {{ activeRangeLabel }}</div>
        </div>
      </div>
    </div>

    <!-- Detailed Statistics Grid -->
    <div class="analytics-stats-grid">
      <p class="section-description section-description--inline">
        Detailed metrics including data processing statistics, temperature extremes, energy production rates, and system utilization.
      </p>
      <div class="stat">
        <span class="stat-label">
          <lucide-icon
            [name]="Database"
            [size]="20"
            [strokeWidth]="1.5"
            aria-hidden="true"
          ></lucide-icon>
          Processed Data
        </span>
        <span class="stat-value">{{ statisticsData.processedDisplay }}</span>
      </div>

      <div class="stat">
        <span class="stat-label">
          <lucide-icon
            [name]="Flame"
            [size]="20"
            [strokeWidth]="1.5"
            aria-hidden="true"
          ></lucide-icon>
          Max. Temperature
        </span>
        <span class="stat-value">{{ statisticsData.stats.tempMax.toFixed(1) }} °C</span>
      </div>

      <div class="stat">
        <span class="stat-label">
          <lucide-icon
            [name]="ArrowLeftRight"
            [size]="20"
            [strokeWidth]="1.5"
            aria-hidden="true"
          ></lucide-icon>
          Temp. Change
        </span>
        <span class="stat-value">
          <span
            class="delta"
            [class.up]="statisticsData.deltas.tempAvgPct > 0"
            [class.down]="statisticsData.deltas.tempAvgPct < 0"
            [attr.title]="
              'Change vs previous window: ' +
              (statisticsData.deltas.tempAvgPct | number : '1.0-1') +
              '%'
            "
          >
            {{ statisticsData.deltas.tempAvgPct || 0 | number : "1.0-1" }}%
            <lucide-icon
              [name]="
                statisticsData.deltas.tempAvgPct > 0
                  ? ArrowUpRight
                  : statisticsData.deltas.tempAvgPct < 0
                  ? ArrowDownRight
                  : Minus
              "
              [size]="12"
              [strokeWidth]="1.5"
              aria-hidden="true"
            >
            </lucide-icon>
          </span>
        </span>
      </div>

      <div class="stat">
        <span class="stat-label">
          <lucide-icon
            [name]="ArrowLeftRight"
            [size]="20"
            [strokeWidth]="1.5"
            aria-hidden="true"
          ></lucide-icon>
          Energy Change
        </span>
        <span class="stat-value">
          <span
            class="delta"
            [class.up]="statisticsData.deltas.energySumPct > 0"
            [class.down]="statisticsData.deltas.energySumPct < 0"
            [attr.title]="
              'Change vs previous window: ' +
              (statisticsData.deltas.energySumPct | number : '1.0-1') +
              '%'
            "
          >
            {{ statisticsData.deltas.energySumPct || 0 | number : "1.0-1" }}%
            <lucide-icon
              [name]="
                statisticsData.deltas.energySumPct > 0
                  ? ArrowUpRight
                  : statisticsData.deltas.energySumPct < 0
                  ? ArrowDownRight
                  : Minus
              "
              [size]="12"
              [strokeWidth]="1.5"
              aria-hidden="true"
            ></lucide-icon>
          </span>
        </span>
      </div>

      <div class="stat">
        <span class="stat-label">
            <lucide-icon
              [name]="Gauge"
              [size]="20"
              [strokeWidth]="1.5"
              aria-hidden="true"
            ></lucide-icon>
            Avg. Production
        </span>
        <span class="stat-value stat-value--production">
          <span class="stat-value-number">{{ statisticsData.stats.prodAvgPerMin.toFixed(3) }}</span>
          <span class="stat-value-unit">kWh/min</span>
        </span>
      </div>

      <div class="stat stat--with-progress">
        <span class="stat-label">
          <lucide-icon
            [name]="Rocket"
            [size]="20"
            [strokeWidth]="1.5"
            aria-hidden="true"
          ></lucide-icon>
          Current vs Peak
        </span>
        <span class="stat-value">{{ statisticsData.stats.utilizationPct }}%</span>
        <div class="progress-bar">
          <div
            class="progress-fill"
            [style.width.%]="statisticsData.stats.utilizationPct"
          ></div>
        </div>
      </div>

      <div class="stat">
        <span class="stat-label">
          <lucide-icon
            [name]="Clock"
            [size]="20"
            [strokeWidth]="1.5"
            aria-hidden="true"
          ></lucide-icon>
          Update Interval
        </span>
        <span class="stat-value">5 s</span>
      </div>

      <div class="stat">
        <span class="stat-label">
          <lucide-icon
            [name]="Hourglass"
            [size]="20"
            [strokeWidth]="1.5"
            aria-hidden="true"
          ></lucide-icon>
          Elapsed Time
        </span>
        <span class="stat-value">{{ statisticsData.elapsedTime }}</span>
      </div>
    </div>
  </section>

</main>

<app-footer></app-footer>

<button
  class="help-button"
  type="button"
  (click)="toggleHelp()"
  aria-label="Show help and information about the application"
>
  <lucide-icon
    [name]="HelpCircle"
    [size]="18"
    [strokeWidth]="1.6"
    aria-hidden="true"
  ></lucide-icon>
</button>

<!-- Help Modal - Tutorial Style -->
@if (showHelp) {
<div class="help-modal-overlay" (click)="closeHelp()" role="dialog" aria-modal="true" aria-labelledby="help-title">
  <div class="help-modal" (click)="$event.stopPropagation()">
    <div class="help-modal__header">
      <div class="help-modal__header-content">
        <h2 id="help-title" class="help-modal__title">
          @if (helpModalTab === 'tutorial') {
          Welcome to Weather Dashboard
          } @else {
            About This Project
          }
        </h2>
        <p class="help-modal__subtitle">
          @if (helpModalTab === 'tutorial') {
            Let's explore how it works
          } @else {
            Technical details and project information
          }
        </p>
      </div>
      <div class="help-modal__tabs">
        <button
          class="help-tab"
          [class.active]="helpModalTab === 'tutorial'"
          (click)="setHelpTab('tutorial')"
          type="button"
        >
          <lucide-icon [name]="HelpCircle" [size]="16" aria-hidden="true"></lucide-icon>
          How to Use
        </button>
        <button
          class="help-tab"
          [class.active]="helpModalTab === 'about'"
          (click)="setHelpTab('about')"
          type="button"
        >
          <lucide-icon [name]="Info" [size]="16" aria-hidden="true"></lucide-icon>
          About Project
        </button>
      </div>
      <button
        class="help-modal__close"
        (click)="closeHelp()"
        aria-label="Close help dialog"
        type="button"
      >
        <lucide-icon [name]="X" [size]="18" aria-hidden="true"></lucide-icon>
      </button>
    </div>

    <div class="help-modal__content">
      @if (helpModalTab === 'tutorial') {
      <!-- Tutorial Slides -->
      <div class="help-tutorial">
        <div class="help-tutorial__slide-container">
          @for (slide of helpSlides; track slide.title; let i = $index) {
            <div 
              class="help-tutorial__slide" 
              [class.help-tutorial__slide--active]="helpSlideIndex === i"
              [attr.aria-hidden]="helpSlideIndex !== i"
            >
              <div class="help-tutorial__slide-content">
                <div class="help-tutorial__icon-wrapper">
                  <div class="help-tutorial__icon-bg"></div>
                  <lucide-icon [name]="slide.icon" class="help-tutorial__icon" [size]="44" [strokeWidth]="1.5" aria-hidden="true"></lucide-icon>
                </div>
                <h3 class="help-tutorial__title">{{ slide.title }}</h3>
                <p class="help-tutorial__description">{{ slide.description }}</p>
              </div>
            </div>
          }
        </div>

        <!-- Slide Indicators & Counter -->
        <div class="help-tutorial__progress">
          <div class="help-tutorial__counter">
            <span class="help-tutorial__counter-current">{{ helpSlideIndex + 1 }}</span>
            <span class="help-tutorial__counter-separator">/</span>
            <span class="help-tutorial__counter-total">{{ helpSlides.length }}</span>
          </div>
          <div class="help-tutorial__indicators" role="tablist" aria-label="Tutorial slides">
            @for (slide of helpSlides; track slide.title; let i = $index) {
              <button
                class="help-tutorial__indicator"
                [class.help-tutorial__indicator--active]="helpSlideIndex === i"
                [class.help-tutorial__indicator--completed]="helpSlideIndex > i"
                (click)="goToHelpSlide(i)"
                [attr.aria-selected]="helpSlideIndex === i"
                [attr.aria-label]="'Go to slide ' + (i + 1) + ': ' + slide.title"
                type="button"
                role="tab"
              ></button>
            }
          </div>
        </div>
      </div>
      } @else {
      <!-- About Project Tab -->
      <div class="help-about-content">
        <div class="about-description">
          <h3>Project Overview</h3>
          <p>
            This is a real-time weather dashboard application that visualizes meteorological data
            including temperature and energy production metrics. The application simulates progressive
            data streaming, updating every 5 seconds to provide live insights into weather patterns
            and energy generation.
          </p>
        </div>

        <div class="about-features">
          <h3>Key Features</h3>
          <ul>
            <li>
              <lucide-icon [name]="Zap" [size]="16" aria-hidden="true"></lucide-icon>
              <strong>Real-time Streaming:</strong> Progressive data updates every 5 seconds
            </li>
            <li>
              <lucide-icon [name]="TrendingUp" [size]="16" aria-hidden="true"></lucide-icon>
              <strong>Interactive Charts:</strong> Time series visualization with Chart.js
            </li>
            <li>
              <lucide-icon [name]="BarChart3" [size]="16" aria-hidden="true"></lucide-icon>
              <strong>Advanced Analytics:</strong> Statistical analysis and trend detection
            </li>
            <li>
              <lucide-icon [name]="Database" [size]="16" aria-hidden="true"></lucide-icon>
              <strong>YAML Data Source:</strong> Data loaded from structured YAML files
            </li>
            <li>
              <lucide-icon [name]="Activity" [size]="16" aria-hidden="true"></lucide-icon>
              <strong>Unit Conversion:</strong> Automatic conversion from deciKelvins to Celsius
            </li>
            <li>
              <lucide-icon [name]="Download" [size]="16" aria-hidden="true"></lucide-icon>
              <strong>Data Export:</strong> Export charts and data in multiple formats
            </li>
            <li>
              <lucide-icon [name]="Bell" [size]="16" aria-hidden="true"></lucide-icon>
              <strong>Alerts System:</strong> Configurable thresholds and notifications
            </li>
            <li>
              <lucide-icon [name]="Filter" [size]="16" aria-hidden="true"></lucide-icon>
              <strong>Advanced Filters:</strong> Filter data by temperature and energy ranges
            </li>
            <li>
              <lucide-icon [name]="Bookmark" [size]="16" aria-hidden="true"></lucide-icon>
              <strong>Saved Views:</strong> Save and load custom dashboard configurations
            </li>
          </ul>
        </div>

        <div class="about-tech">
          <h3>Technology Stack</h3>
          <div class="tech-grid">
            <div class="tech-item">
              <strong>Framework:</strong> Angular 17 (Standalone Components)
            </div>
            <div class="tech-item">
              <strong>Language:</strong> TypeScript
            </div>
            <div class="tech-item">
              <strong>Charts:</strong> Chart.js 4.5
            </div>
            <div class="tech-item">
              <strong>Data Processing:</strong> js-yaml
            </div>
            <div class="tech-item">
              <strong>Reactive Programming:</strong> RxJS
            </div>
            <div class="tech-item">
              <strong>Styling:</strong> CSS3 with Custom Properties
            </div>
            <div class="tech-item">
              <strong>Icons:</strong> Lucide Angular
            </div>
            <div class="tech-item">
              <strong>Typography:</strong> Inter (Google Fonts)
            </div>
          </div>
        </div>

        <div class="about-data">
          <h3>Data Source</h3>
          <p>
            The application reads meteorological data from a YAML file (<code>data.yml</code>). The
            data includes temperature measurements in deciKelvins (dK) and energy production values
            in watt-hours (Wh), which are automatically converted to Celsius and kilowatt-hours (kWh)
            for display.
          </p>
          <p class="muted">
            <strong>Update Frequency:</strong> Every 5 seconds<br />
            <strong>Data Format:</strong> YAML with time-series data points<br />
            <strong>Processing:</strong> Real-time conversion and streaming
          </p>
        </div>

        <div class="about-actions">
          <button class="export-button" (click)="exportAllChartsAsImages()" type="button">
            <lucide-icon [name]="Image" [size]="18" aria-hidden="true"></lucide-icon>
            Export Charts as Images
          </button>
          <button class="export-button" (click)="exportDataAsCSV()" type="button">
            <lucide-icon [name]="FileText" [size]="18" aria-hidden="true"></lucide-icon>
            Export Data as CSV
          </button>
        </div>
      </div>
      }
    </div>

    <div class="help-modal__footer">
      <div class="help-modal__footer-actions">
        @if (helpModalTab === 'tutorial') {
        <button 
          class="help-modal__button help-modal__button--secondary" 
          (click)="prevHelpSlide()" 
          [disabled]="helpSlideIndex === 0"
          type="button"
          aria-label="Previous slide"
        >
          <lucide-icon [name]="ChevronLeft" [size]="18" aria-hidden="true"></lucide-icon>
          Previous
        </button>
        @if (helpSlideIndex === helpSlides.length - 1) {
          <button class="help-modal__button" (click)="closeHelp()" type="button">
            Got it!
          </button>
        } @else {
          <button 
            class="help-modal__button" 
            (click)="nextHelpSlide()" 
            type="button"
            aria-label="Next slide"
          >
            Next
            <lucide-icon [name]="ChevronRight" [size]="18" aria-hidden="true"></lucide-icon>
            </button>
          }
        } @else {
          <button class="help-modal__button" (click)="closeHelp()" type="button">
            Close
          </button>
        }
      </div>
    </div>
  </div>
</div>
}
