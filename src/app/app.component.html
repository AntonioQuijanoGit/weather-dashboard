<header class="header">
  <div class="brand">
    <div class="brand__logo">üå§Ô∏è</div>
    <div class="brand__text">
      <h1>Meteol√≥gica</h1>
      <p>Dashboard de Predicci√≥n Meteorol√≥gica</p>
    </div>
  </div>

  <div class="header-actions">
    <!-- Switch Claro/Oscuro -->
    <div class="theme-switch" aria-label="Cambiar tema">
  <input
  #themeToggle
  id="themeToggle"
  type="checkbox"
  class="theme-switch__input"
  [checked]="themeChoice==='dark'"
  (change)="setTheme(themeToggle.checked ? 'dark' : 'light')"
  aria-labelledby="themeSwitchLabel"
/>


      <label class="theme-switch__label" for="themeToggle">
        <span class="theme-switch__icon">‚òÄÔ∏è</span>
        <span class="theme-switch__track">
          <span class="theme-switch__thumb"></span>
        </span>
        <span id="themeSwitchLabel" class="theme-switch__icon">üåô</span>
      </label>
    </div>

    <div class="status" [class.active]="isStreaming" aria-live="polite">
      <span class="status-indicator"></span>
      <span>{{ isStreaming ? 'Actualizando datos en tiempo real' : 'Inicializando...' }}</span>
    </div>
  </div>
</header>

<main class="container">
  <!-- Controles (solo series) -->
  <section class="toolbar card-surface">
    <div class="series-group" role="group" aria-label="Series">
      <span class="label">Series:</span>

      <label class="toggle">
        <input
          #tempChk
          type="checkbox"
          [checked]="showTemp"
          (change)="onTempCheckboxChange(tempChk.checked)">
        <span>üå°Ô∏è Temperatura</span>
      </label>

      <label class="toggle">
        <input
          #energyChk
          type="checkbox"
          [checked]="showEnergy"
          (change)="onEnergyCheckboxChange(energyChk.checked)">
        <span>‚ö° Energ√≠a</span>
      </label>
    </div>
  </section>

  <!-- KPIs -->
  <section class="current-values card-surface">
    <h2 class="section-title">Indicadores actuales</h2>

    @if (processedDisplay==='0') {
      <div class="skeletons">
        <div class="skeleton-card"></div>
        <div class="skeleton-card"></div>
      </div>
    } @else {
      <div class="cards">
        <div class="card kpi" role="group" aria-label="Temperatura media">
          <div class="kpi-header">
            <div class="card-icon">üå°Ô∏è</div>
            <h3>Temperatura media</h3>
          </div>
          <div class="kpi-body">
            <div class="value">
              {{ tempDisplay }}¬∞C
              <span class="trend"
                    [class.up]="trendTemp==='up'"
                    [class.down]="trendTemp==='down'"
                    [class.flat]="trendTemp==='flat'">
                {{ trendTemp==='up' ? '‚ñ≤' : trendTemp==='down' ? '‚ñº' : '‚Äî' }}
              </span>
            </div>
            <div class="timestamp">√öltima actualizaci√≥n: {{ currentTime }}</div>
            <canvas #sparkTemp class="sparkline" aria-hidden="true"></canvas>
          </div>
        </div>

        <div class="card kpi" role="group" aria-label="Energ√≠a producida">
          <div class="kpi-header">
            <div class="card-icon">‚ö°</div>
            <h3>Energ√≠a producida</h3>
          </div>
          <div class="kpi-body">
            <div class="value">
              {{ energyDisplay }} kWh
              <span class="trend"
                    [class.up]="trendEnergy==='up'"
                    [class.down]="trendEnergy==='down'"
                    [class.flat]="trendEnergy==='flat'">
                {{ trendEnergy==='up' ? '‚ñ≤' : trendEnergy==='down' ? '‚ñº' : '‚Äî' }}
              </span>
            </div>
            <div class="timestamp">√öltima actualizaci√≥n: {{ currentTime }}</div>
            <canvas #sparkEnergy class="sparkline" aria-hidden="true"></canvas>
          </div>
        </div>
      </div>
    }
  </section>

  <!-- Gr√°ficas -->
  <section class="charts">
    <div class="chart-container card-surface">
      <div class="section-title">Temperatura (¬∞C)</div>
      <canvas #temperatureChart></canvas>
    </div>
    <div class="chart-container card-surface">
      <div class="section-title">Energ√≠a producida (kWh)</div>
      <canvas #energyChart></canvas>
    </div>
  </section>

  <!-- Estad√≠sticas -->
  <section class="statistics card-surface">
    <h2 class="section-title">Estad√≠sticas</h2>
    <div class="stats-grid">
      <div class="stat">
        <span class="stat-label">Datos procesados</span>
        <span class="stat-value">{{ processedDisplay }}</span>
      </div>
      <div class="stat">
        <span class="stat-label">Intervalo de actualizaci√≥n</span>
        <span class="stat-value">5 segundos</span>
      </div>
      <div class="stat">
        <span class="stat-label">Tiempo transcurrido</span>
        <span class="stat-value">{{ elapsedTime }}</span>
      </div>
    </div>
  </section>
</main>

<footer class="footer">
  <div class="footer-content">
    <p>¬© {{ currentYear }} Meteol√≥gica ‚Äî Plataforma de an√°lisis meteorol√≥gico en tiempo real</p>
    <p class="tech-info">Desarrollado con <strong>Angular 17</strong> ¬∑ <strong>Chart.js</strong></p>
  </div>
</footer>
